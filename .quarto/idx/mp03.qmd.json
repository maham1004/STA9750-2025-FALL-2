{"title":"Mini Project 03","markdown":{"yaml":{"title":"Mini Project 03","author":"Maham Hassan","date":"October 30, 2025","format":{"html":{"code-fold":true,"toc":true}}},"headingText":"Introduction","containsRefs":false,"markdown":"\n\nNew York City's street trees play a crucial role in shaping the city's environment and public spaces, but they also face challenges ranging from invasive species to uneven maintenance across neighborhoods. In this project, we will analyze the NYC TreeMap data, which catalogs tree species, health, and location across all council districts, to uncover patterns and inequities in the urban canopy.\n\nBy combining spatial data with tree condition indicators, we will explore the data. The final part of this project proposes a targeted tree initiative that addresses two invasive species problems.\n\n\n\nThe following maps show NYC districts and tree coverage wihin. \n```{r, results='hide', message=FALSE, warning=FALSE}\nlibrary(sf)\nlibrary(dplyr)\n\nget_nyc_council_districts <- function() {\n  dir.create(\"data/mp03\", showWarnings = FALSE, recursive = TRUE)\n  \n  url <- \"https://s-media.nyc.gov/agencies/dcp/assets/files/zip/data-tools/bytes/city-council/nycc_25c.zip\"\n  zip_path <- \"data/mp03/nycc_25c.zip\"\n  unzip_dir <- \"data/mp03/nycc_25c\"\n  \n  if (!file.exists(zip_path)) {\n    download.file(url, destfile = zip_path, mode = \"wb\", method = \"libcurl\")\n  }\n  \n  if (!dir.exists(unzip_dir)) {\n    unzip(zip_path, exdir = unzip_dir)\n  }\n  \n  shp_file <- list.files(unzip_dir, pattern = \"\\\\.shp$\", full.names = TRUE, recursive = TRUE)\n  if (length(shp_file) == 0) stop(\"No .shp file found after unzipping.\")\n  \n  nycc <- sf::st_read(shp_file[1], quiet = TRUE)\n  nycc_wgs84 <- sf::st_transform(nycc, crs = \"WGS84\")\n  return(nycc_wgs84)\n}\n\n# Call the function and simplify geometry\nnycc_districts <- get_nyc_council_districts()\nnycc_districts_simplified <- nycc_districts |>\n  mutate(geometry = st_simplify(geometry, dTolerance = 30))\n\n# Optional: quick check\nplot(nycc_districts_simplified[\"CounDist\"], main = \"Simplified NYC Council Districts\")\n\n```\n\n```{r, results='hide', message=FALSE, warning=FALSE}\nlibrary(httr2)\nlibrary(sf)\nlibrary(dplyr)\nlibrary(glue)\n\nget_nyc_tree_points <- function(limit = 50000) {\n  out_dir <- \"data/mp03/trees\"\n  dir.create(out_dir, showWarnings = FALSE, recursive = TRUE)\n\n  base_url <- \"https://data.cityofnewyork.us/resource/hn5i-inap.geojson\"\n  chunk <- 1\n  done <- FALSE\n\n  while (!done) {\n    file_path <- file.path(out_dir, glue(\"trees_{limit}_{chunk}.geojson\"))\n    offset <- (chunk - 1) * limit\n\n    # Only download if file doesn't already exist\n    if (!file.exists(file_path)) {\n      message(glue(\"Downloading chunk {chunk} (offset = {offset})...\"))\n      resp <- request(base_url) |>\n        req_url_query(`$limit` = limit, `$offset` = offset) |>\n        req_perform()\n\n      # Save raw GeoJSON to disk\n      writeBin(resp_body_raw(resp), file_path)\n    } else {\n      message(glue(\"Chunk {chunk} already exists. Skipping download.\"))\n    }\n\n    # Check if this is the last chunk\n    tree_data <- st_read(file_path, quiet = TRUE)\n    n <- nrow(tree_data)\n    message(glue(\"Chunk {chunk} has {n} rows.\"))\n\n    if (n < limit) {\n      done <- TRUE\n      message(\"All tree point data downloaded \")\n    } else {\n      chunk <- chunk + 1\n    }\n  }\n\n  # Combine all saved chunks into one sf object\n  all_files <- list.files(out_dir, pattern = \"\\\\.geojson$\", full.names = TRUE)\n  all_data <- all_files |>\n    lapply(st_read, quiet = TRUE) |>\n    bind_rows()\n\n  message(\"NYC Tree Points successfully combined \")\n  return(all_data)\n}\n\n# combined tree data:\nnyc_trees <- get_nyc_tree_points(limit = 50000)\n\n# Save to disk so it doesn't need to be recombined next time\nsaveRDS(nyc_trees, \"data/mp03/nyc_tree_points_combined.rds\")\n\n```\n```{r}\nlibrary(ggplot2)\nlibrary(sf)\n\nggplot() +\n  # Plot ALL tree points first (as a background layer)\n  geom_sf(data = nyc_trees, color = \"darkgreen\", size = 0.05, alpha = 0.4) +\n  \n  # Plot district boundaries on top\n  geom_sf(data = nycc_districts_simplified, fill = NA, color = \"black\", linewidth = 0.3) +\n  \n  labs(\n    title = \"NYC Tree Points with Council District Boundaries Overlay\",\n    subtitle = \"Districts drawn on top of tree data for clarity\",\n    caption = \"Data sources: NYC Open Data (Trees), NYC DCP (Districts)\"\n  ) +\n  theme_minimal()\n\n```\n```{r}\n# make sure that both are sf objects and in the same CRS\nst_crs(nyc_trees) == st_crs(nycc_districts_simplified)\n\n# Join tree points to the district they fall in\ntrees_with_districts <- st_join(\n  nyc_trees,\n  nycc_districts_simplified[, c(\"CounDist\")], # Keep only district ID\n  join = st_intersects       \n)\n\n```\n\n## Data Exploration\n\n1. Which council district has the most trees?\n\nDistrict 51, in Staten Island, has the greatest number of trees. \n\n```{r}\nlibrary(dplyr)\nlibrary(DT)\nlibrary(scales)\nlibrary(htmltools)\n\n# Count trees per district\ntree_counts <- trees_with_districts |>\n  st_drop_geometry() |>\n  group_by(CounDist) |>\n  summarise(Tree_Count = n()) |>\n  arrange(desc(Tree_Count))\n\n# Format numbers and column names\ntree_counts_formatted <- tree_counts |>\n  mutate(Tree_Count = comma(Tree_Count)) |>\n  rename(`Council District` = CounDist, `Tree Count` = Tree_Count)\n\n# Interactive table: Top 5\ndatatable(\n  tree_counts_formatted |> head(5),\n  rownames = FALSE,\n  caption = htmltools::tags$caption(\n    style = \"caption-side: top; text-align: center; font-weight: bold; color: #333; font-size: 16px;\",\n    \"Top 5 NYC Council Districts by Tree Count\"\n  ),\n  options = list(\n    pageLength = 5,\n    autoWidth = TRUE,\n    columnDefs = list(\n      list(className = 'dt-left', targets = \"_all\")\n    ),\n    dom = 't',\n    scrollX = FALSE,\n    compact = TRUE\n  ),\n  class = 'compact stripe hover row-border order-column',\n  style = \"bootstrap\"\n)\n#\n#\n#\n#\n#\n```\n\n2. Which council district has the highest density of trees? \n\nDistrict 7 in Manhattan has the highest tree density. \n\n\n```{r}\n# Extract district area\ndistrict_areas <- nycc_districts_simplified |>\n  st_drop_geometry() |>\n  select(CounDist, Shape_Area)\n\n# Compute density (trees per sq km)\ndensity_data <- tree_counts |>\n  inner_join(district_areas, by = \"CounDist\") |>\n  mutate(Tree_Density_per_SqKm = Tree_Count / (Shape_Area / 1e6)) |>\n  arrange(desc(Tree_Density_per_SqKm))\n\n# Format numbers and column names\ndensity_data_formatted <- density_data |>\n  mutate(\n    Tree_Count = comma(Tree_Count),\n    Tree_Density_per_SqKm = comma(round(Tree_Density_per_SqKm, 1))\n  ) |>\n  rename(\n    `Council District` = CounDist,\n    `Tree Count` = Tree_Count,\n    `Tree Density per SqKm` = Tree_Density_per_SqKm\n  )\n\n# Interactive table: Top 5\ndatatable(\n  density_data_formatted |> head(5),\n  rownames = FALSE,\n  caption = htmltools::tags$caption(\n    style = \"caption-side: top; text-align: center; font-weight: bold; color: #333; font-size: 16px;\",\n    \"Top 5 NYC Council Districts by Tree Density (trees per sq km)\"\n  ),\n  options = list(\n    pageLength = 5,\n    autoWidth = TRUE,\n    columnDefs = list(\n      list(className = 'dt-left', targets = \"_all\")\n    ),\n    dom = 't',\n    scrollX = FALSE,\n    compact = TRUE\n  ),\n  class = 'compact stripe hover row-border order-column',\n  style = \"bootstrap\"\n)\n#\n#\n#\n#\n#\n```\n\n3.  Which district has highest fraction of dead trees out of all trees?\n\nDistrict 32 has the highest fraction of dead trees. \n\n```{r}\n# Count dead trees per district\ndead_tree_counts <- trees_with_districts |>\n  st_drop_geometry() |>\n  filter(tpcondition == \"Dead\") |>\n  group_by(CounDist) |>\n  summarise(Dead_Trees = n())\n\n# Compute fraction of dead trees\ndead_fraction <- tree_counts |>\n  inner_join(dead_tree_counts, by = \"CounDist\") |>\n  mutate(Fraction_Dead = Dead_Trees / Tree_Count) |>\n  arrange(desc(Fraction_Dead))\n\n# Format numbers and column names\ndead_fraction_formatted <- dead_fraction |>\n  mutate(\n    Tree_Count = comma(Tree_Count),\n    Dead_Trees = comma(Dead_Trees),\n    Fraction_Dead = percent(Fraction_Dead, accuracy = 0.1)\n  ) |>\n  rename(\n    `Council District` = CounDist,\n    `Total Trees` = Tree_Count,\n    `Dead Trees` = Dead_Trees,\n    `Percent Dead` = Fraction_Dead\n  )\n\n# Interactive table: Top 5\ndatatable(\n  dead_fraction_formatted |> head(5),\n  rownames = FALSE,\n  caption = htmltools::tags$caption(\n    style = \"caption-side: top; text-align: center; font-weight: bold; color: #333; font-size: 16px;\",\n    \"Top 5 NYC Council Districts by Percent of Dead Trees\"\n  ),\n  options = list(\n    pageLength = 5,\n    autoWidth = TRUE,\n    columnDefs = list(\n      list(className = 'dt-left', targets = \"_all\")\n    ),\n    dom = 't',\n    scrollX = FALSE,\n    compact = TRUE\n  ),\n  class = 'compact stripe hover row-border order-column',\n  style = \"bootstrap\"\n)\n#\n#\n#\n#\n#\n#\n\n```\n\n4.  What is the most common tree species in Manhattan?\n\nThe Gleditsia triacanthos var. inermis - Thornless honeylocust is the most common tree species in Manhattan\n\n```{r}\nlibrary(dplyr)\nlibrary(DT)\nlibrary(scales)\nlibrary(htmltools)\n\n# Add borough column based on council district\ntrees_with_borough <- trees_with_districts |>\n  mutate(\n    Borough = case_when(\n      CounDist >= 1 & CounDist <= 10 ~ \"Manhattan\",\n      CounDist >= 11 & CounDist <= 18 ~ \"Bronx\",\n      CounDist >= 19 & CounDist <= 32 ~ \"Queens\",\n      CounDist >= 33 & CounDist <= 48 ~ \"Brooklyn\",\n      CounDist >= 49 & CounDist <= 51 ~ \"Staten Island\",\n      TRUE ~ NA_character_\n    )\n  )\n\n# Filter for Manhattan and count tree species\nmanhattan_species <- trees_with_borough |>\n  filter(Borough == \"Manhattan\") |>\n  st_drop_geometry() |>\n  group_by(genusspecies) |>\n  summarise(Count = n()) |>\n  arrange(desc(Count))\n\n# Format results and pick top 5\nmanhattan_species_formatted <- manhattan_species |>\n  mutate(Count = comma(Count)) |>\n  rename(`Tree Species` = genusspecies)\n\n# Interactive table of top 5 species\ndatatable(\n  manhattan_species_formatted |> head(5),\n  rownames = FALSE,\n  caption = htmltools::tags$caption(\n    style = \"caption-side: top; text-align: center; font-weight: bold; color: #333; font-size: 16px;\",\n    \"Top 5 Tree Species in Manhattan\"\n  ),\n  options = list(\n    pageLength = 5,\n    autoWidth = TRUE,\n    columnDefs = list(list(className = 'dt-left', targets = \"_all\")),\n    dom = 't'\n  )\n)\n#\n#\n#\n#\n#\n```\n5. What is the species of the tree closest to Baruch’s campus?\n\nThe closest tree to Baruch is a Liquidambar styraciflua, a sweetgum tree. It is 19.48 meters away from Baruch. \n\n```{r, results='hide', message=FALSE, warning=FALSE}\n\n\nlibrary(sf)\nlibrary(dplyr)\nlibrary(units)\n\n# Function to create a spatial point\nnew_st_point <- function(lat, lon) {\n  st_sfc(\n    st_point(c(lon, lat)),\n    crs = 4326  # WGS84 for input\n  )\n}\n\n# Create Baruch's location as a spatial point in WGS84\nbaruch_point <- new_st_point(40.7403, -73.9833)\n\n# Transform both trees and the point to meters\ntrees_transformed <- st_transform(trees_with_districts, 2263)\nbaruch_projected <- st_transform(baruch_point, 2263)\n\n# Compute distance to Baruch and find the closest tree\nclosest_tree <- trees_transformed |>\n  mutate(distance = st_distance(geometry, baruch_projected)) |>\n  slice_min(distance, n = 1) |>\n  st_drop_geometry()\n\nclosest_tree_species <- closest_tree$genusspecies\nclosest_tree_distance <- set_units(closest_tree$distance, \"meters\")\n\n# Output\ncat(\"The closest tree to Baruch is a:\", closest_tree_species, \"\\n\")\ncat(\"Distance:\", round(closest_tree_distance, 2), \"\\n\")\n\n```\n\n## Native Resistance: A Spotted Lanternfly Reduction Plan\n\nWithin the past 4 years, The Spotted Lanternfly  has rapidly taken over New York City in the summer months. The Lanternfly is a pesky invasive species that devastates important crops such as grapes, apples and hardwoods. In addition to the economic damage, there are ecological threats. \n\n### Proposed Initiative\n\nWe aim to reduce Spotted Lanternfly habitat and promote planting native species while doing so. The Lanternfly's preferred host tree is the Ailanthus Altissima (tree of heaven). This tree itself also happens to be an invasive species that threatens the native habitat. \n\nA study done by Penn State has found that the Lanternfly rarely feeds on Oaks and Conifers. Our project thus aims to reduce lanternfly habitat by \n\n1. Removing Ailanthus Altissima and \n2. Replanting resilient native species such as            - White Oak (Quercus Alba)\n   - Swamp White Oak (Quercus Bicolor)\n   - Eastern Red Cedar ( Juniperus Virginiana)\n   - Eastern White Pine (Pinus Strobus)      \n  \n#### Methodology\n\nFirst, we must determine which District has the highest population of the tree of heaven to determine the best candidate for our pilot program. Comparing the top 5 districts with high populations of the tree of heaven, we find that district 50 has the highest population with 363 trees. \n\n\n```{r}\nlibrary(dplyr)\nlibrary(stringr)\nlibrary(DT)\nlibrary(scales)\n\n# Filter for Tree of Heaven species\ntree_of_heaven <- trees_with_districts |>\n  st_drop_geometry() |>\n  filter(str_detect(genusspecies, regex(\"Ailanthus altissima|tree of heaven\", ignore_case = TRUE)))\n\n# Count by district\ntree_of_heaven_counts <- tree_of_heaven |>\n  group_by(CounDist) |>\n  summarise(TreeOfHeaven_Count = n()) |>\n  arrange(desc(TreeOfHeaven_Count))\n\n# Format and rename columns\ntree_of_heaven_formatted <- tree_of_heaven_counts |>\n  mutate(TreeOfHeaven_Count = comma(TreeOfHeaven_Count)) |>\n  rename(\n    `Council District` = CounDist,\n    `Tree of Heaven Count` = TreeOfHeaven_Count\n  )\n\n# Interactive table: Top 5 with styling updates\ndatatable(\n  tree_of_heaven_formatted |> head(5),\n  rownames = FALSE,\n  caption = htmltools::tags$caption(\n    style = \"caption-side: top; text-align: center; font-weight: bold; color: #333;\",\n    \"Top 5 NYC Council Districts by Tree of Heaven Count\"\n  ),\n  options = list(\n    dom = 't',                \n    pageLength = 5,          \n    ordering = FALSE,         \n    columnDefs = list(\n      list(className = 'dt-left', targets = \"_all\")  # Left-align columns\n    )\n  ),\n  class = 'cell-border stripe'  \n)\n\n#\n#\n```\n\nThe Following graphic shows the locations of all Ailanthus Altissima in District 50. \n\n```{r}\nlibrary(sf)\nlibrary(ggplot2)\nlibrary(dplyr)\n\n# Filter District 50\ndistrict_50 <- nycc_districts_simplified |>\n  filter(CounDist == 50) |>\n  st_transform(4326)\n\n# Filter Trees of Heaven only and transform CRS\ntrees_of_heaven_dist50 <- trees_with_districts |>\n  filter(\n    CounDist == 50,\n    grepl(\"Ailanthus altissima|tree of heaven\", genusspecies, ignore.case = TRUE)\n  ) |>\n  st_transform(4326)\n\n# Check if any Tree of Heaven found\nif (nrow(trees_of_heaven_dist50) == 0) {\n  message(\"No Tree of Heaven found in District 50.\")\n} else {\n  # Plot map\n  ggplot() +\n    geom_sf(data = district_50, fill = \"white\", color = \"black\") +\n    geom_sf(data = trees_of_heaven_dist50, color = \"red\", size = 1, alpha = 0.6) +\n    labs(\n      title = \"Tree of Heaven Locations in NYC Council District 50\",\n      subtitle = \"District boundary shown, Tree of Heaven marked as red dots\"\n    ) +\n    theme_minimal()\n}\n\n```\nThere area 363 Ailanthus altissima trees in district 50. Our pilot program will remove all of these trees and replace then with the four native species in consultation with NYC Parks and their ecological expertise. We will closely monitor lantern fly populations in the distrcit before and after the pilot program.\n\n#### Predicted Impact\n\nThe initiative, if successful, will \n\n-  Restore native habitats \n-  Increase native New York plant life\n-  Reduce invasive plant populations \n-  Reduce invasive insect populations\n\nThis pilot program could make a huge difference in the NYC ecological landscape. It is imperative that we mitigate invasive species as soon as possible. The longer that these species are allowed to thrive, the longer they wreak havok and cause irreperable damage. \n\n\n\n\n\n\n\n\n","srcMarkdownNoYaml":"\n## Introduction\n\nNew York City's street trees play a crucial role in shaping the city's environment and public spaces, but they also face challenges ranging from invasive species to uneven maintenance across neighborhoods. In this project, we will analyze the NYC TreeMap data, which catalogs tree species, health, and location across all council districts, to uncover patterns and inequities in the urban canopy.\n\nBy combining spatial data with tree condition indicators, we will explore the data. The final part of this project proposes a targeted tree initiative that addresses two invasive species problems.\n\n\n\nThe following maps show NYC districts and tree coverage wihin. \n```{r, results='hide', message=FALSE, warning=FALSE}\nlibrary(sf)\nlibrary(dplyr)\n\nget_nyc_council_districts <- function() {\n  dir.create(\"data/mp03\", showWarnings = FALSE, recursive = TRUE)\n  \n  url <- \"https://s-media.nyc.gov/agencies/dcp/assets/files/zip/data-tools/bytes/city-council/nycc_25c.zip\"\n  zip_path <- \"data/mp03/nycc_25c.zip\"\n  unzip_dir <- \"data/mp03/nycc_25c\"\n  \n  if (!file.exists(zip_path)) {\n    download.file(url, destfile = zip_path, mode = \"wb\", method = \"libcurl\")\n  }\n  \n  if (!dir.exists(unzip_dir)) {\n    unzip(zip_path, exdir = unzip_dir)\n  }\n  \n  shp_file <- list.files(unzip_dir, pattern = \"\\\\.shp$\", full.names = TRUE, recursive = TRUE)\n  if (length(shp_file) == 0) stop(\"No .shp file found after unzipping.\")\n  \n  nycc <- sf::st_read(shp_file[1], quiet = TRUE)\n  nycc_wgs84 <- sf::st_transform(nycc, crs = \"WGS84\")\n  return(nycc_wgs84)\n}\n\n# Call the function and simplify geometry\nnycc_districts <- get_nyc_council_districts()\nnycc_districts_simplified <- nycc_districts |>\n  mutate(geometry = st_simplify(geometry, dTolerance = 30))\n\n# Optional: quick check\nplot(nycc_districts_simplified[\"CounDist\"], main = \"Simplified NYC Council Districts\")\n\n```\n\n```{r, results='hide', message=FALSE, warning=FALSE}\nlibrary(httr2)\nlibrary(sf)\nlibrary(dplyr)\nlibrary(glue)\n\nget_nyc_tree_points <- function(limit = 50000) {\n  out_dir <- \"data/mp03/trees\"\n  dir.create(out_dir, showWarnings = FALSE, recursive = TRUE)\n\n  base_url <- \"https://data.cityofnewyork.us/resource/hn5i-inap.geojson\"\n  chunk <- 1\n  done <- FALSE\n\n  while (!done) {\n    file_path <- file.path(out_dir, glue(\"trees_{limit}_{chunk}.geojson\"))\n    offset <- (chunk - 1) * limit\n\n    # Only download if file doesn't already exist\n    if (!file.exists(file_path)) {\n      message(glue(\"Downloading chunk {chunk} (offset = {offset})...\"))\n      resp <- request(base_url) |>\n        req_url_query(`$limit` = limit, `$offset` = offset) |>\n        req_perform()\n\n      # Save raw GeoJSON to disk\n      writeBin(resp_body_raw(resp), file_path)\n    } else {\n      message(glue(\"Chunk {chunk} already exists. Skipping download.\"))\n    }\n\n    # Check if this is the last chunk\n    tree_data <- st_read(file_path, quiet = TRUE)\n    n <- nrow(tree_data)\n    message(glue(\"Chunk {chunk} has {n} rows.\"))\n\n    if (n < limit) {\n      done <- TRUE\n      message(\"All tree point data downloaded \")\n    } else {\n      chunk <- chunk + 1\n    }\n  }\n\n  # Combine all saved chunks into one sf object\n  all_files <- list.files(out_dir, pattern = \"\\\\.geojson$\", full.names = TRUE)\n  all_data <- all_files |>\n    lapply(st_read, quiet = TRUE) |>\n    bind_rows()\n\n  message(\"NYC Tree Points successfully combined \")\n  return(all_data)\n}\n\n# combined tree data:\nnyc_trees <- get_nyc_tree_points(limit = 50000)\n\n# Save to disk so it doesn't need to be recombined next time\nsaveRDS(nyc_trees, \"data/mp03/nyc_tree_points_combined.rds\")\n\n```\n```{r}\nlibrary(ggplot2)\nlibrary(sf)\n\nggplot() +\n  # Plot ALL tree points first (as a background layer)\n  geom_sf(data = nyc_trees, color = \"darkgreen\", size = 0.05, alpha = 0.4) +\n  \n  # Plot district boundaries on top\n  geom_sf(data = nycc_districts_simplified, fill = NA, color = \"black\", linewidth = 0.3) +\n  \n  labs(\n    title = \"NYC Tree Points with Council District Boundaries Overlay\",\n    subtitle = \"Districts drawn on top of tree data for clarity\",\n    caption = \"Data sources: NYC Open Data (Trees), NYC DCP (Districts)\"\n  ) +\n  theme_minimal()\n\n```\n```{r}\n# make sure that both are sf objects and in the same CRS\nst_crs(nyc_trees) == st_crs(nycc_districts_simplified)\n\n# Join tree points to the district they fall in\ntrees_with_districts <- st_join(\n  nyc_trees,\n  nycc_districts_simplified[, c(\"CounDist\")], # Keep only district ID\n  join = st_intersects       \n)\n\n```\n\n## Data Exploration\n\n1. Which council district has the most trees?\n\nDistrict 51, in Staten Island, has the greatest number of trees. \n\n```{r}\nlibrary(dplyr)\nlibrary(DT)\nlibrary(scales)\nlibrary(htmltools)\n\n# Count trees per district\ntree_counts <- trees_with_districts |>\n  st_drop_geometry() |>\n  group_by(CounDist) |>\n  summarise(Tree_Count = n()) |>\n  arrange(desc(Tree_Count))\n\n# Format numbers and column names\ntree_counts_formatted <- tree_counts |>\n  mutate(Tree_Count = comma(Tree_Count)) |>\n  rename(`Council District` = CounDist, `Tree Count` = Tree_Count)\n\n# Interactive table: Top 5\ndatatable(\n  tree_counts_formatted |> head(5),\n  rownames = FALSE,\n  caption = htmltools::tags$caption(\n    style = \"caption-side: top; text-align: center; font-weight: bold; color: #333; font-size: 16px;\",\n    \"Top 5 NYC Council Districts by Tree Count\"\n  ),\n  options = list(\n    pageLength = 5,\n    autoWidth = TRUE,\n    columnDefs = list(\n      list(className = 'dt-left', targets = \"_all\")\n    ),\n    dom = 't',\n    scrollX = FALSE,\n    compact = TRUE\n  ),\n  class = 'compact stripe hover row-border order-column',\n  style = \"bootstrap\"\n)\n#\n#\n#\n#\n#\n```\n\n2. Which council district has the highest density of trees? \n\nDistrict 7 in Manhattan has the highest tree density. \n\n\n```{r}\n# Extract district area\ndistrict_areas <- nycc_districts_simplified |>\n  st_drop_geometry() |>\n  select(CounDist, Shape_Area)\n\n# Compute density (trees per sq km)\ndensity_data <- tree_counts |>\n  inner_join(district_areas, by = \"CounDist\") |>\n  mutate(Tree_Density_per_SqKm = Tree_Count / (Shape_Area / 1e6)) |>\n  arrange(desc(Tree_Density_per_SqKm))\n\n# Format numbers and column names\ndensity_data_formatted <- density_data |>\n  mutate(\n    Tree_Count = comma(Tree_Count),\n    Tree_Density_per_SqKm = comma(round(Tree_Density_per_SqKm, 1))\n  ) |>\n  rename(\n    `Council District` = CounDist,\n    `Tree Count` = Tree_Count,\n    `Tree Density per SqKm` = Tree_Density_per_SqKm\n  )\n\n# Interactive table: Top 5\ndatatable(\n  density_data_formatted |> head(5),\n  rownames = FALSE,\n  caption = htmltools::tags$caption(\n    style = \"caption-side: top; text-align: center; font-weight: bold; color: #333; font-size: 16px;\",\n    \"Top 5 NYC Council Districts by Tree Density (trees per sq km)\"\n  ),\n  options = list(\n    pageLength = 5,\n    autoWidth = TRUE,\n    columnDefs = list(\n      list(className = 'dt-left', targets = \"_all\")\n    ),\n    dom = 't',\n    scrollX = FALSE,\n    compact = TRUE\n  ),\n  class = 'compact stripe hover row-border order-column',\n  style = \"bootstrap\"\n)\n#\n#\n#\n#\n#\n```\n\n3.  Which district has highest fraction of dead trees out of all trees?\n\nDistrict 32 has the highest fraction of dead trees. \n\n```{r}\n# Count dead trees per district\ndead_tree_counts <- trees_with_districts |>\n  st_drop_geometry() |>\n  filter(tpcondition == \"Dead\") |>\n  group_by(CounDist) |>\n  summarise(Dead_Trees = n())\n\n# Compute fraction of dead trees\ndead_fraction <- tree_counts |>\n  inner_join(dead_tree_counts, by = \"CounDist\") |>\n  mutate(Fraction_Dead = Dead_Trees / Tree_Count) |>\n  arrange(desc(Fraction_Dead))\n\n# Format numbers and column names\ndead_fraction_formatted <- dead_fraction |>\n  mutate(\n    Tree_Count = comma(Tree_Count),\n    Dead_Trees = comma(Dead_Trees),\n    Fraction_Dead = percent(Fraction_Dead, accuracy = 0.1)\n  ) |>\n  rename(\n    `Council District` = CounDist,\n    `Total Trees` = Tree_Count,\n    `Dead Trees` = Dead_Trees,\n    `Percent Dead` = Fraction_Dead\n  )\n\n# Interactive table: Top 5\ndatatable(\n  dead_fraction_formatted |> head(5),\n  rownames = FALSE,\n  caption = htmltools::tags$caption(\n    style = \"caption-side: top; text-align: center; font-weight: bold; color: #333; font-size: 16px;\",\n    \"Top 5 NYC Council Districts by Percent of Dead Trees\"\n  ),\n  options = list(\n    pageLength = 5,\n    autoWidth = TRUE,\n    columnDefs = list(\n      list(className = 'dt-left', targets = \"_all\")\n    ),\n    dom = 't',\n    scrollX = FALSE,\n    compact = TRUE\n  ),\n  class = 'compact stripe hover row-border order-column',\n  style = \"bootstrap\"\n)\n#\n#\n#\n#\n#\n#\n\n```\n\n4.  What is the most common tree species in Manhattan?\n\nThe Gleditsia triacanthos var. inermis - Thornless honeylocust is the most common tree species in Manhattan\n\n```{r}\nlibrary(dplyr)\nlibrary(DT)\nlibrary(scales)\nlibrary(htmltools)\n\n# Add borough column based on council district\ntrees_with_borough <- trees_with_districts |>\n  mutate(\n    Borough = case_when(\n      CounDist >= 1 & CounDist <= 10 ~ \"Manhattan\",\n      CounDist >= 11 & CounDist <= 18 ~ \"Bronx\",\n      CounDist >= 19 & CounDist <= 32 ~ \"Queens\",\n      CounDist >= 33 & CounDist <= 48 ~ \"Brooklyn\",\n      CounDist >= 49 & CounDist <= 51 ~ \"Staten Island\",\n      TRUE ~ NA_character_\n    )\n  )\n\n# Filter for Manhattan and count tree species\nmanhattan_species <- trees_with_borough |>\n  filter(Borough == \"Manhattan\") |>\n  st_drop_geometry() |>\n  group_by(genusspecies) |>\n  summarise(Count = n()) |>\n  arrange(desc(Count))\n\n# Format results and pick top 5\nmanhattan_species_formatted <- manhattan_species |>\n  mutate(Count = comma(Count)) |>\n  rename(`Tree Species` = genusspecies)\n\n# Interactive table of top 5 species\ndatatable(\n  manhattan_species_formatted |> head(5),\n  rownames = FALSE,\n  caption = htmltools::tags$caption(\n    style = \"caption-side: top; text-align: center; font-weight: bold; color: #333; font-size: 16px;\",\n    \"Top 5 Tree Species in Manhattan\"\n  ),\n  options = list(\n    pageLength = 5,\n    autoWidth = TRUE,\n    columnDefs = list(list(className = 'dt-left', targets = \"_all\")),\n    dom = 't'\n  )\n)\n#\n#\n#\n#\n#\n```\n5. What is the species of the tree closest to Baruch’s campus?\n\nThe closest tree to Baruch is a Liquidambar styraciflua, a sweetgum tree. It is 19.48 meters away from Baruch. \n\n```{r, results='hide', message=FALSE, warning=FALSE}\n\n\nlibrary(sf)\nlibrary(dplyr)\nlibrary(units)\n\n# Function to create a spatial point\nnew_st_point <- function(lat, lon) {\n  st_sfc(\n    st_point(c(lon, lat)),\n    crs = 4326  # WGS84 for input\n  )\n}\n\n# Create Baruch's location as a spatial point in WGS84\nbaruch_point <- new_st_point(40.7403, -73.9833)\n\n# Transform both trees and the point to meters\ntrees_transformed <- st_transform(trees_with_districts, 2263)\nbaruch_projected <- st_transform(baruch_point, 2263)\n\n# Compute distance to Baruch and find the closest tree\nclosest_tree <- trees_transformed |>\n  mutate(distance = st_distance(geometry, baruch_projected)) |>\n  slice_min(distance, n = 1) |>\n  st_drop_geometry()\n\nclosest_tree_species <- closest_tree$genusspecies\nclosest_tree_distance <- set_units(closest_tree$distance, \"meters\")\n\n# Output\ncat(\"The closest tree to Baruch is a:\", closest_tree_species, \"\\n\")\ncat(\"Distance:\", round(closest_tree_distance, 2), \"\\n\")\n\n```\n\n## Native Resistance: A Spotted Lanternfly Reduction Plan\n\nWithin the past 4 years, The Spotted Lanternfly  has rapidly taken over New York City in the summer months. The Lanternfly is a pesky invasive species that devastates important crops such as grapes, apples and hardwoods. In addition to the economic damage, there are ecological threats. \n\n### Proposed Initiative\n\nWe aim to reduce Spotted Lanternfly habitat and promote planting native species while doing so. The Lanternfly's preferred host tree is the Ailanthus Altissima (tree of heaven). This tree itself also happens to be an invasive species that threatens the native habitat. \n\nA study done by Penn State has found that the Lanternfly rarely feeds on Oaks and Conifers. Our project thus aims to reduce lanternfly habitat by \n\n1. Removing Ailanthus Altissima and \n2. Replanting resilient native species such as            - White Oak (Quercus Alba)\n   - Swamp White Oak (Quercus Bicolor)\n   - Eastern Red Cedar ( Juniperus Virginiana)\n   - Eastern White Pine (Pinus Strobus)      \n  \n#### Methodology\n\nFirst, we must determine which District has the highest population of the tree of heaven to determine the best candidate for our pilot program. Comparing the top 5 districts with high populations of the tree of heaven, we find that district 50 has the highest population with 363 trees. \n\n\n```{r}\nlibrary(dplyr)\nlibrary(stringr)\nlibrary(DT)\nlibrary(scales)\n\n# Filter for Tree of Heaven species\ntree_of_heaven <- trees_with_districts |>\n  st_drop_geometry() |>\n  filter(str_detect(genusspecies, regex(\"Ailanthus altissima|tree of heaven\", ignore_case = TRUE)))\n\n# Count by district\ntree_of_heaven_counts <- tree_of_heaven |>\n  group_by(CounDist) |>\n  summarise(TreeOfHeaven_Count = n()) |>\n  arrange(desc(TreeOfHeaven_Count))\n\n# Format and rename columns\ntree_of_heaven_formatted <- tree_of_heaven_counts |>\n  mutate(TreeOfHeaven_Count = comma(TreeOfHeaven_Count)) |>\n  rename(\n    `Council District` = CounDist,\n    `Tree of Heaven Count` = TreeOfHeaven_Count\n  )\n\n# Interactive table: Top 5 with styling updates\ndatatable(\n  tree_of_heaven_formatted |> head(5),\n  rownames = FALSE,\n  caption = htmltools::tags$caption(\n    style = \"caption-side: top; text-align: center; font-weight: bold; color: #333;\",\n    \"Top 5 NYC Council Districts by Tree of Heaven Count\"\n  ),\n  options = list(\n    dom = 't',                \n    pageLength = 5,          \n    ordering = FALSE,         \n    columnDefs = list(\n      list(className = 'dt-left', targets = \"_all\")  # Left-align columns\n    )\n  ),\n  class = 'cell-border stripe'  \n)\n\n#\n#\n```\n\nThe Following graphic shows the locations of all Ailanthus Altissima in District 50. \n\n```{r}\nlibrary(sf)\nlibrary(ggplot2)\nlibrary(dplyr)\n\n# Filter District 50\ndistrict_50 <- nycc_districts_simplified |>\n  filter(CounDist == 50) |>\n  st_transform(4326)\n\n# Filter Trees of Heaven only and transform CRS\ntrees_of_heaven_dist50 <- trees_with_districts |>\n  filter(\n    CounDist == 50,\n    grepl(\"Ailanthus altissima|tree of heaven\", genusspecies, ignore.case = TRUE)\n  ) |>\n  st_transform(4326)\n\n# Check if any Tree of Heaven found\nif (nrow(trees_of_heaven_dist50) == 0) {\n  message(\"No Tree of Heaven found in District 50.\")\n} else {\n  # Plot map\n  ggplot() +\n    geom_sf(data = district_50, fill = \"white\", color = \"black\") +\n    geom_sf(data = trees_of_heaven_dist50, color = \"red\", size = 1, alpha = 0.6) +\n    labs(\n      title = \"Tree of Heaven Locations in NYC Council District 50\",\n      subtitle = \"District boundary shown, Tree of Heaven marked as red dots\"\n    ) +\n    theme_minimal()\n}\n\n```\nThere area 363 Ailanthus altissima trees in district 50. Our pilot program will remove all of these trees and replace then with the four native species in consultation with NYC Parks and their ecological expertise. We will closely monitor lantern fly populations in the distrcit before and after the pilot program.\n\n#### Predicted Impact\n\nThe initiative, if successful, will \n\n-  Restore native habitats \n-  Increase native New York plant life\n-  Reduce invasive plant populations \n-  Reduce invasive insect populations\n\nThis pilot program could make a huge difference in the NYC ecological landscape. It is imperative that we mitigate invasive species as soon as possible. The longer that these species are allowed to thrive, the longer they wreak havok and cause irreperable damage. \n\n\n\n\n\n\n\n\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"output-file":"mp03.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.8.23","editor":{"mode":"source"},"theme":"morph","title":"Mini Project 03","author":"Maham Hassan","date":"October 30, 2025"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}